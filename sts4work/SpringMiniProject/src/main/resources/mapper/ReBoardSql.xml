<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="boot.data.mapper.ReBoardMapperInter">
  
  <!-- 갯수 및 검색 -->
  <select id="getTotalCount" resultType="int" parameterType="Map">
    select count(*) from re_board 
    <if test="searchcolumn!=null and searchword!=null">
      where ${searchcolumn} like concat('%', #{searchword}, '%')
    </if>
  </select>
  
  <!-- insert -->
  <insert id="insertReBoard" parameterType="ReBoardDto">
    insert into re_board (id,name,subject,photo,content,regroup,restep,relevel,writeday)
    values (#{id}, #{name}, #{subject}, #{photo}, #{content},#{regroup}, #{restep},#{relevel}, now())
  </insert>
  
  <!-- 페이징처리 -->
  <select id="getPaginglist" parameterType="Map" resultType="ReBoardDto">
    select * from re_board
    <if test="searchcolumn!=null and searchword!=null">
      where ${searchcolumn} like concat('%', #{searchword}, '%')
    </if>
    order by regroup desc, restep asc limit #{startnum}, #{perpage}
  </select>
  
  <!-- num값 넘기기 -->
  <select id="getData" parameterType="String" resultType="ReBoardDto">
    select * from re_board where num=#{num}
  </select>
  
  <!-- 최신글이 위에 올라오더라도 내가 쓴 글이 위에 정렬하기위해서 사용 -->
  <update id="updateRestep" parameterType="Map">
    update re_board set restep=restep+1 where regroup=#{regroup} and restep>#{restep}
  </update>
  
  <!-- readcount 페이지 처리  -->
  <update id="updateReadCount" parameterType="int">
    update re_board set readcount=readcount+1 where num=#{num}
  </update>
  
  <!-- 마지막 페이징 -->
  <select id="getMaxNum" resultType="int">
    select ifnull(max(num),0) from re_board
  </select>
  
  <!-- 삭제 -->
  <delete id="deleteBoard" parameterType="int">
    delete from re_board where num= #{num}
  </delete>
  
  <!-- 좋아요 카운트  -->
  <update id="likesUpdte" parameterType="int">
    update re_board set likes=likes+1 where num=#{num}
  </update>
</mapper>